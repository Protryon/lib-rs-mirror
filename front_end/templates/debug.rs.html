@use kitchen_sink::CompatByCrateVersion;
@use kitchen_sink::Compat;

@(table: (Vec<u16>, CompatByCrateVersion))

<h1>Crate compatibility matrix</h1>
<style>
    td.bad @{  background: #fee; @}
    td.bad.certain @{  background: #faa; @}
    td.ok @{  background: #efe; @}
    td.ok.certain @{  background: #afa; @}
    td.ok.bad @{  background: #aaa; @}
</style>
<table>
    <thead><tr><th></th>
        @for rustc_ver in table.0.iter().rev() {
            <th>1.@rustc_ver</th>
        }
    </tr></thead>
    <tbody>
        @for (v, row) in table.1.iter().rev() {
            <tr>
                <th>@v</th>
                @for rustc_ver in table.0.iter().rev().copied() {
                    <td class='
                        @if rustc_ver <= row.newest_bad().unwrap_or(0) {bad}
                        @if rustc_ver <= row.newest_bad_certain().unwrap_or(0) {bad certain}
                        @if rustc_ver >= row.oldest_ok().unwrap_or(999) {ok}
                        @if rustc_ver >= row.oldest_ok_certain().unwrap_or(999) {ok certain}
                    '>
                        @if let Some(compat) = row.compat_data_for_rustc(rustc_ver) {
                            @if compat == Compat::VerifiedWorks {
                                ‚úÖ
                            }
                            @if compat == Compat::ProbablyWorks {
                                ‚úì
                            }
                            @if compat == Compat::DefinitelyIncompatible || compat == Compat::LikelyIncompatible {
                                ‚ùå
                            }
                            @if compat == Compat::SuspectedIncompatible {
                                êÑÇ
                            }
                            @if compat == Compat::BrokenDeps {
                                d
                            }
                       }
                    </td>
                }
            </tr>
        }
    </tbody>
</table>
