@use crate::templates::base;
@use crate::Urler;
@use crate::SearchPage;

@(p: &SearchPage, url: &Urler)

@:base(&p.page(), {

<header id="serp">
    <div class="inner-col">
        <div class="breadcrumbs">
            <h1><a href="/">Crates.rs</a></h1>
            â€º Search (beta)
        </div>
    </div>
    <div class="inner-col">
        <form id=search method="get" action="/search">
            <input placeholder="name, keywords, description" autocapitalize="off" autocorrect="off" autocomplete="off" tabindex="1" type=search value="@p.query" name=q><button type=submit>Search</button>
        </form>
        <nav>
            <ul>
                @if !p.good_results.is_empty() {
                    <li class=active>Sorted by relevance</li>
                }
                <li><a href="@url.search_ddg(p.query)">I'm feeling ducky</a></li>
            </ul>
        </nav>
    </div>
</header>
<main id="results">
    <div class="inner-col">
        @if p.good_results.is_empty() {
            <p class=notfound>Nothing found :(</p>
            <p class=tryalso>Try <a href="@url.search_ddg(p.query)">searching with duckduckgo</a> or <a href="@url.search_crates_io(p.query)">on crates.io</a>.</p>
        } else {
            <ol>
            @for (i, c) in p.good_results.iter().chain(p.bad_results).enumerate() {
                <li>
                    <a href="@url.krate_by_name(&c.crate_name)"><div class=h>
                        <h4>@c.crate_name</h4>
                        <p class=desc>@p.render_markdown_str(&c.description)</p>
                    </div>
                    <div class=meta>
                        <span class="version @p.version_class(&c.version)"><span>v</span>@c.version</span>
                        @if c.monthly_downloads >= 100 {
                            <span class=downloads title="c.monthly_downloads recent downloads">@if let Some((num,unit)) = Some(p.downloads(c.monthly_downloads)) {@num<b>@unit</b>}</span>
                        }
                    </div></a>
                </li>
                @if i == p.good_results.len() {
                    <p class=tryalso>Try <a href="@url.search_ddg(p.query)">searching with duckduckgo</a> or <a href="@url.search_crates_io(p.query)">on crates.io</a>.</p>
                }
            }
            </ol>
        }
    </div>
</main>

<footer>
    <div class="inner-col">
        <p>Search powered by <a href="https://crates.rs/crates/tantivy">tantivy</a>.</p>
        <p>Browse <a href="/">all categories</a>.
    </div>
</footer>
})
